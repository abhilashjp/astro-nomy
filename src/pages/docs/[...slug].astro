---
import { MdxComponents } from "@/components/content/mdx-components";
import GuidePostLayout from "@/layouts/guide-post.astro"; // You might want to rename this to ContentLayout or DocLayout
import { getCollection, type CollectionEntry } from "astro:content";

import { getPublishedDocs } from '@/lib/content.js'; 

export async function getStaticPaths() {
  const docs = await getPublishedDocs(); 
  return docs.map((doc) => ({
    params: { slug: doc.slug },
    props: { doc }, 
  }));
}

type Props = {
  doc: CollectionEntry<"docs">;
};

const { doc } = Astro.props; 
const { slug } = Astro.params;

// Check if doc exists first
if (!slug || !doc) {
  return new Response(null, {
    status: 404,
    statusText: "Not found",
  });
}

const { Content } = await doc.render();
---

<GuidePostLayout {...doc}>
  <Content components={MdxComponents} />
</GuidePostLayout>